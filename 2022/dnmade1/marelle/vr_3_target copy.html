<!-- https://www.w3docs.com/snippets/javascript/how-to-create-and-trigger-event-in-javascript.html -->
<html>

<head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@3.0.3/dist/aframe-event-set-component.min.js"></script>
    <script>
        AFRAME.registerComponent('findepartie', {
            schema: {
                cible: { type: 'string'},
            },
            init: function () {
                var cible = this.data.cible;
                
                //Ecouter l'événement.
                document.addEventListener('build', function (e) { 
                    console.log("gagné");
                    var sceneEl = document.querySelector('a-scene');
                    var target = sceneEl.querySelector('#'+cible);
                    target.setAttribute('visible', true);
                 }, false);

                //distribuer l'événement.
                setTimeout(gagne, 5000);
                function gagne() {
                    console.log("envoi");
                    var event = new Event('build');
                    document.dispatchEvent(event);
                }

            },
            tick: function () {
            }
        });
    </script>

</head>

<body>

    <a-scene background="color: skyblue">

        <a-box id="cible" 
            width="0.25" height="0.25" depth="0.25"
            position="-1 0 -3" 
            rotation="0 45 0"
            color="silver" 
            findepartie="cible: winner"
            >
        </a-box>


        <a-sphere id="winner" color="yellow" radius="0.5" position="-1 0 -3" visible="false"></a-sphere>

        <a-plane position="0 0 -4" 
                 rotation="-90 0 0" 
                 width="4" height="4" 
                 color="gray">
        </a-plane>

    </a-scene>

</body>

</html>