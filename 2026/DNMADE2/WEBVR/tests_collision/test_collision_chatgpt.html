<html>

<head>
    <meta charset="utf-8">
    <title>Player Collision VR</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-physics-system@4.0.2/dist/aframe-physics-system.min.js"></script>
</head>

<body>
    <a-scene physics="gravity: 0 -9.8 0">

        <!-- Lumière -->
        <a-entity light="type: ambient; intensity: 0.5"></a-entity>
        <a-entity light="type: directional; intensity: 0.8" position="2 4 -3"></a-entity>

        <!-- Sol -->
        <a-plane rotation="-90 0 0" width="10" height="10" color="#7BC8A4" static-body></a-plane>

        <!-- Mur -->
        <a-box id="wall" position="0 1 -3" depth="0.2" height="2" width="4" color="#333333" static-body></a-box>

        <!-- Player (box pour éviter l'erreur Geometry) -->
        <a-entity id="player" position="0 1 0" geometry="primitive: box; height: 2; width: 0.6; depth: 0.6"
            material="opacity: 0; transparent: true" dynamic-body movement-controls="speed: 0.1">

            <!-- Caméra -->
            <a-camera position="0 0.6 0" wasd-controls look-controls></a-camera>
        </a-entity>

        <script>
            AFRAME.registerComponent('wall-collision', {
                init: function () {
                    const wall = document.querySelector('#wall');
                    const player = document.querySelector('#player');

                    player.addEventListener('collide', function (e) {
                        if (e.detail.body.el === wall) {
                            console.log("Collision détectée avec le mur !");
                            wall.setAttribute('color', 'red');

                            // Bloque le mouvement
                            player.setAttribute('movement-controls', 'speed: 0');
                        }
                    });
                }
            });

            document.querySelector('#player').setAttribute('wall-collision', '');
        </script>

    </a-scene>
</body>

</html>